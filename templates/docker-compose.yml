# Template docker-compose.yml
# Copy this to your project and customize as needed

services:
  app:
    image: hdae/ai-base
    restart: "no"
    # ports:
    #   - "8000:8000"
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - UV_CACHE_DIR=/workspace/.uv-cache
      - PYTHON_VERSION=${PYTHON_VERSION:-3.12}
    volumes:
      # Persistent storage for the entire workspace
      - app-data:/workspace

      # Cache volume (Shared)
      - uv-cache:/workspace/.uv-cache

      # Startup script (required - customize for your project)
      - ./start.sh:/start.sh

      # Mount your project source code (for development)
      # Recommended: Use git submodules or clone directly, then mount here
      # - .:/workspace/app

    working_dir: /workspace/app
    tty: true
    security_opt:
      - no-new-privileges:true

    # ========================================
    # GPU Support (Uncomment if needed)
    # ========================================
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]

    # ========================================
    # Health Check (Uncomment if needed)
    # ========================================
    # healthcheck:
    #   test: ["CMD", "python", "-c", "print('ok')"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3
    #   start_period: 60s

# ========================================
# Volumes
# ========================================
# Note: shared_uv-cache must be created before starting:
#   docker volume create shared_uv-cache
# Or use: task up (which creates it automatically)
volumes:
  app-data:
  uv-cache:
    name: shared_uv-cache
    external: true
